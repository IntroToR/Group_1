---
title: "Group_1_Project"
author: "Matthew Runyon, Winston Wong, & Leo D'Agostino"
date: "10/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The data set that we have chosen to work with is the "Volcano Eruptions" data set, coming from Week 20 of the 2020 TidyTuesday project. This data is provided by the Smithsonian Institute. The data, which is split into five files (`volcano`, `eruptions`, `events`, `tree_rings`, and `sulfur`) and can be read in using the following code:

```{r}
volcano <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/volcano.csv')
eruptions <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/eruptions.csv')
events <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/events.csv')
tree_rings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/tree_rings.csv')
sulfur <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-12/sulfur.csv')
```
__Sulfur Concentration Dataset__

Here is just a simple line graph plotting sulfur concentration in ice cores across years of deposition.

```{r}
library(tidyverse)

ggplot(sulfur, aes(x=year, y=neem))+
  geom_line()+
  ggtitle("Sulfur Concentration per Year from NEEM Ice Cores")+
  labs(x="Year (AD)", y="Sulfur Content (ng/g)")+
  theme(panel.grid=element_blank())

ggplot(sulfur, aes(x=year, y=wdc))+
  geom_line()+
  ggtitle("Sulfur Concentration per Year from WDC Ice Cores")+
  labs(x="Year (AD)", y="Sulfur Content (ng/g)")+
  theme(panel.grid=element_blank())   
```

Conduct a statistical analysis such as Analysis of Variance or Linear Regression:

First step is to create scatter plots to visualize a possible linear relationship between the independent and dependent variable, in this case "year" and sulfur concentration for each location. From the scatterplot it does not appear that there is a linear relationship between "year" and sulfur concentration for each location 

```{r}
scatter.smooth(x=sulfur$year, y=sulfur$neem, main="year ~ neem") #scatter plot for year vs. neem
scatter.smooth(x=sulfur$year, y=sulfur$wdc, main="year ~ wdc") #scatter plot for year vs. wdc
```

Second step is to Create boxplots to check for outliers for the variables "neem" and "wdc" sulfur concentrations; From both boxplots we conclude that there are many outliers
```{r}

#Boxplot for sulfur levels from NEEM created using base R
sulfur$neem[as.numeric(sulfur$neem)]
boxplot(sulfur$neem, main = "Sulfur detected in ng/g from NEEM",
        xlab = "sulfur (ng/g)", horizontal = TRUE)

#Boxplot for sulfur levels from WDC created using base R
WDCsulfur <- as.numeric(sulfur$wdc)
boxplot(sulfur$wdc, main = "Sulfur detected in ng/g from WDC",
        xlab = "sulfur (ng/g)", horizontal = TRUE)

```

Next step is create a density plot to see if sulfur concentration follows a normal distribution at both locations (NEEM and WDC). From the density plots, we see that sulfur concentrations from NEEM and WDC follow a right skewed distribution and is non-normal

We will need to download the following package to create density plots:
library(e1071)

```{r}
par(mfrow=c(1, 2))  # divide graph area in 2 columns

#creating density plot for sulfur levels from NEEM
plot(density(sulfur$neem, na.rm = TRUE), main="NEEM Sulfur Levels",
  ylab="Frequency", sub=paste("Skewness:", round(e1071::skewness(sulfur$neem, na.rm = TRUE), 2)))+
  polygon(density(sulfur$neem, na.rm = TRUE), col="red")

#creating density plot for sulfur levels from WDC
plot(density(sulfur$wdc, na.rm = TRUE), main="WDC Sulfur levels", 
  ylab="Frequency", sub=paste("Skewness:", round(e1071::skewness(sulfur$wdc, na.rm = TRUE), 2)))+ 
  polygon(density(sulfur$wdc), col="red")
  
```

After creating and checking the previous 3 plots, we have to test for correlation between year and sulfur concentrations in both locations.Even though the disibutions of sulfur levels appears non-normal for NEEM and WDC, we will continue to test for correlation using the Pearson's "r" for the sake of the project. Our null hypothesis is that there is no correlation between year and sulfur levels for NEEM and WDC. The alternative hypothesis is there is a correlation between year and sulfur levels for NEEM and WDC.

Both tests revealed p-levels below 0.05. We reject the null hypothesis and conclude that there is a correlation between year and sulfur levels for NEEM and WDC

```{r}
#calculating the Pearson's "r" for sulfur levels from NEEM
cor(sulfur$year, sulfur$neem, method = "pearson", use = "complete.obs")
#testing if the correlation is statistically significant from 0
cor.test(sulfur$year, sulfur$wdc, method="pearson")

#calculating the Pearson's "r" for sulfur levels from WDC
cor(sulfur$year, sulfur$wdc, method = "pearson", use = "complete.obs")
#testing if the correlation is statistically significant from 0
cor.test(sulfur$year, sulfur$wdc, method="pearson")

```

Building a Linear Model - Building a linear model allows us to establish a relationship between year and sulfur levels at NEEM and WDC locations as a
sulfur levels as a function for year. Linear models for sulfur levels at both locations are shown below:

NEEM sulfur levels (ng/g) = 19.886023 - 0.005519 * year
WDC sulfur levels (ng/g) = 21.02073 - 0.01072 * year

```{r}
NEEM_linear_model <- lm(neem ~ year, data = sulfur) #linear model for Sulfur levels at NEEM
NEEM_linear_model

WDC_linear_model <- lm(wdc ~ year, data = sulfur) #linear model for Sulfur levels at WDC
WDC_linear_model
```

Checking if our linear model is statistically significant - The null hypothesis is that the coefficients associated with sulfur levels at NEEM/WDC and year is equal to zero. The alternative hypothesis is that the coefficients are not equal to zero and there is a relationship between sulfur levels at NEEM/WDC and year.Our conclusions are noted below:

p-value for the linear model for sulfur levels at NEEM was above the 0.05 threshold, we fail to reject the null hypothesis that the coefficients associated with sulfur levels at NEEM and year is equal to zero

p-value for the linear model for sulfur levels at WDC was below the 0.05 threshold, we reject the null hypothesis and conclude that there is a relationship between sulfur levels at WDC and year.

```{r}
summary(NEEM_linear_model) #model summary for sulfur levels at NEEM

summary(WDC_linear_model) #model summary for sulfur levels at WDC
```

Saving the means of sulfur levels at NEEM and WDC as a text file
```{r}
write.table(mean(sulfur$neem, na.rm = TRUE), "neem_mean.txt", sep = "\t")
write.table(mean(sulfur$wdc, na.rm = TRUE), "wdc_mean.txt", sep = "\t")
```

__Tree Ring Dataset__

Likewise, here is just a simple line graph plotting tree ring Z-scores and European Temperature Index historical data.

```{r}
ggplot(tree_rings, aes(x=year, y=n_tree))+
  geom_line()+
  ggtitle("Tree Ring Z-Scores per Year")+
  labs(x="Year (AD)", y="Z-Score")+
  theme(panel.grid=element_blank())

ggplot(tree_rings, aes(x=year, y=europe_temp_index))+
  geom_line()+
  ggtitle("European Temperature Index per Year")+
  labs(x="Year (AD)", y="European Temperature Index")+
  theme(panel.grid=element_blank())

```
__Volcano Dataset__

__Data Cleanup__

First I cleaned up the data in the `primary_volcano_type` column by removing all duplicate values of plural classifiers (removed all (es) and (s)). Then I coverted this column, as well as `country`, `region`, `subregion`, `tectonic_settings`, `evidence_category`, `major_rock_.`, and `minor_rock_.` to factors. I also changed all the unknown `last_eruption_year` data with `NA` and converted those to numeric values. Finally, I arrange the data, create a new columns for years since the last eruption date using the `last_eruption_year` variable, and order the columns how I want them.

```{r}
volcano
volcano$primary_volcano_type<-gsub(".(es).", "", volcano$primary_volcano_type)
volcano$primary_volcano_type<-gsub(".(s).", "", volcano$primary_volcano_type)
volcano$primary_volcano_type<-sub("Stratovolcano.", "Stratovolcano", volcano$primary_volcano_type)
volcano$primary_volcano_type<-as.factor(volcano$primary_volcano_type)
volcano$country<-as.factor(volcano$country)
volcano$region<-as.factor(volcano$region)
volcano$subregion<-as.factor(volcano$subregion)
volcano$tectonic_settings<-as.factor(volcano$tectonic_settings)
volcano$evidence_category<-as.factor(volcano$evidence_category)
volcano$major_rock_1<-as.factor(volcano$major_rock_1)
volcano$major_rock_2<-as.factor(volcano$major_rock_2)
volcano$major_rock_3<-as.factor(volcano$major_rock_3)
volcano$major_rock_4<-as.factor(volcano$major_rock_4)
volcano$major_rock_5<-as.factor(volcano$major_rock_5)
volcano$minor_rock_1<-as.factor(volcano$minor_rock_1)
volcano$minor_rock_2<-as.factor(volcano$minor_rock_2)
volcano$minor_rock_3<-as.factor(volcano$minor_rock_3)
volcano$minor_rock_4<-as.factor(volcano$minor_rock_4)
volcano$minor_rock_5<-as.factor(volcano$minor_rock_5)
volcano$last_eruption_year<-as.numeric(gsub("Unknown", NA, volcano$last_eruption_year))
volcano<-volcano%>%
  arrange(primary_volcano_type, last_eruption_year, elevation)%>%
  mutate(years_ago=2020-last_eruption_year)
ordered_columns<-c("volcano_number", "volcano_name", "region", "subregion", "country", "latitude", "longitude", "tectonic_settings", "primary_volcano_type", "elevation", "last_eruption_year", "years_ago", "evidence_category", "population_within_5_km","population_within_10_km","population_within_30_km","population_within_100_km", "major_rock_1","major_rock_2","major_rock_3","major_rock_4","major_rock_5","minor_rock_1","minor_rock_2","minor_rock_3","minor_rock_4","minor_rock_5")
volcano[ordered_columns]

```

__Types of Volcanoes__

Here I create a bar chart to show the types of volcanos present among the provided data. Based on this chart, we can see that, by a large margin, stratovolcanos are the most common type of volcano.

```{r}
type_count<-volcano %>% 
  group_by(primary_volcano_type) %>%
  summarise(no_rows1 = length(primary_volcano_type))

ggplot(volcano, aes(x=primary_volcano_type))+
  geom_bar()+
  ggtitle("Number of Volcanos by Type")+
  labs(x="Type of Volcano", y="Number of Volcanos")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=type_count ,aes(x=primary_volcano_type, y=no_rows1, label=no_rows1), nudge_y=30)
```

Here I create a bar chart showing the number of volcanos in each tectonic subcategory. Here we can see that the most common tectonic setting is for subduction zone / continental crust.

```{r}
tectonic_count<-volcano %>% 
  group_by(tectonic_settings) %>%
  summarise(no_rows3 = length(tectonic_settings))

ggplot(volcano, aes(x=tectonic_settings))+
  geom_bar()+
  ggtitle("Number of Volcanos by Tectonic Setting")+
  labs(x="Tectonic Setting", y="Number of Volcanos")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=tectonic_count ,aes(x=tectonic_settings, y=no_rows3, label=no_rows3), nudge_y=50)
```

__Elevation__

Here is a histogram showing the frequency of different volcano heights. The majority of volcanos are under 2,500 feet tall, with most being 1,000 to 1,500 feet tall.
```{r}
ggplot(volcano, aes(x=elevation))+
  geom_histogram(binwidth=500)+
  ggtitle("Histogram of Volcano Elevations")+
  labs(x="Elevation", y="Observations")+
  theme(panel.grid=element_blank())
```

__Means and Multiple Comparisons (Volcano Type) of Elevation__

Here I am using the `car` package for the Levene's Test of Homogeneity of Variance, and the `dunn.test` package as a post hoc test for the Kruskal-Wallis test that I perform if the prerequisites for conducting an ANOVA are not met (homogeneity of variance and normal distribution of residuals). Normal distribution of residuals is evaluated using the `shapiro.test()` function.
```{r}

library(car)
library(dunn.test)

mean(volcano$elevation)

ggplot(volcano, aes(x=elevation, y=primary_volcano_type))+
  geom_boxplot()+
  ggtitle("Boxplot of Volcano Elevation by Volcano Type")+
  labs(x="Elevation (Meters above Sea Level)", y="Volcano Type")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: All elevations are equal among volcano types.
#HA: At least one mean elevation is different.
model1=lm(elevation~primary_volcano_type, data=volcano)
res_values1<-residuals(model1)
shapiro.test(res_values1)
leveneTest(model1)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW1<-kruskal.test(elevation~primary_volcano_type, data=volcano)
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN1<-as.data.frame(dunn.test(volcano$elevation, g=volcano$primary_volcano_type, kw=T))

```

__Multiple Comparisons (Volcano Type)  of Population - 5km__
```{r}
ggplot(volcano, aes(x=population_within_5_km, y=primary_volcano_type))+
  geom_boxplot()+
  ggtitle("Boxplot of Population within 5 km by Volcano Type")+
  labs(x="Population", y="Volcano Type")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: All populations are equal among volcano types
#HA: At least one mean population is different
model2=lm(population_within_5_km~primary_volcano_type, data=volcano)
res_values2<-residuals(model2)
shapiro.test(res_values2)
leveneTest(model2)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW2<-kruskal.test(population_within_5_km~primary_volcano_type, data=volcano)
KW2
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN2<-as.data.frame(dunn.test(volcano$population_within_5_km, g=volcano$primary_volcano_type, kw=T))
```

__Multiple Comparisons of (Volcano Type) Population- 10 km__
```{r}
ggplot(volcano, aes(x=population_within_10_km, y=primary_volcano_type))+
  geom_boxplot()+
  ggtitle("Boxplot of Population within 10 km by Volcano Type")+
  labs(x="Population", y="Volcano Type")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: All populations are equal among volcano types
#HA: At least one mean population is different
model3=lm(population_within_10_km~primary_volcano_type, data=volcano)
res_values3<-residuals(model3)
shapiro.test(res_values3)
leveneTest(model3)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW3<-kruskal.test(population_within_10_km~primary_volcano_type, data=volcano)
KW3
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN3<-as.data.frame(dunn.test(volcano$population_within_10_km, g=volcano$primary_volcano_type, kw=T))
```

__Multiple Comparisons (Volcano Type) of Population - 30 km__
```{r}
ggplot(volcano, aes(x=population_within_30_km, y=primary_volcano_type))+
  geom_boxplot()+
  ggtitle("Boxplot of Population within 30 km by Volcano Type")+
  labs(x="Population", y="Volcano Type")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: All populations are equal among volcano types
#HA: At least one mean population is different
model4=lm(population_within_30_km~primary_volcano_type, data=volcano)
res_values4<-residuals(model4)
shapiro.test(res_values4)
leveneTest(model4)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW4<-kruskal.test(population_within_30_km~primary_volcano_type, data=volcano)
KW4
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN4<-as.data.frame(dunn.test(volcano$population_within_30_km, g=volcano$primary_volcano_type, kw=T))
```

__Multiple Comparisons (Volcano Type) of Population - 100 km__
```{r}
ggplot(volcano, aes(x=population_within_100_km, y=primary_volcano_type))+
  geom_boxplot()+
  ggtitle("Boxplot of Population within 100 km by Volcano Type")+
  labs(x="Population", y="Volcano Type")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: All populations are equal among volcano types
#HA: At least one mean population is different
model5=lm(population_within_100_km~primary_volcano_type, data=volcano)
res_values5<-residuals(model5)
shapiro.test(res_values5)
leveneTest(model5)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW5<-kruskal.test(population_within_100_km~primary_volcano_type, data=volcano)
KW5
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN5<-as.data.frame(dunn.test(volcano$population_within_100_km, g=volcano$primary_volcano_type, kw=T))
```

Here, I am showing essentially the same thing as above. I calculated the means population per volcano type and plotted them in bar graphs. This is a better representation than the boxplots above because the outliers skewed the range and caused the boxes of the boxplot to be so compressed that no real differences could be seen. However, as an important note, because these outliers were so severe, they do skew the mean values reported.

```{r, figures-side, fig.show="hold", out.width="100%"}
population_means_by_volcano_type<-group_by(volcano, primary_volcano_type) %>% 
  summarize(mean_population_within_5_km = mean(population_within_5_km), mean_population_within_10_km = mean(population_within_10_km), mean_population_within_30_km = mean(population_within_30_km), mean_population_within_100_km = mean(population_within_100_km))
population_means_by_volcano_type[,2:5]<-round(population_means_by_volcano_type[,2:5],digits=0)

ggplot(population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_5_km))+
  geom_col()+
  ggtitle("Mean Population Living within 5km of Volcanos by Volcano Type")+
  labs(x="Volcano Type", y="Mean Population within 5km")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_5_km, label=mean_population_within_5_km), nudge_y=10000, size=3)

ggplot(population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_10_km))+
  geom_col()+
  ggtitle("Mean Population Living within 10km of Volcanos by Volcano Type")+
  labs(x="Volcano Type", y="Mean Population within 10km")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_10_km, label=mean_population_within_10_km), nudge_y=10000, size=3)

ggplot(population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_30_km))+
  geom_col()+
  ggtitle("Mean Population Living within 30km of Volcanos by Volcano Type")+
  labs(x="Volcano Type", y="Mean Population within 30km")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_30_km, label=mean_population_within_30_km), nudge_y=25000, size=3)

ggplot(population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_100_km))+
  geom_col()+
  ggtitle("Mean Population Living within 100km of Volcanos by Volcano Type")+
  labs(x="Volcano Type", y="Mean Population within 100km")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=population_means_by_volcano_type, aes(x=primary_volcano_type, y=mean_population_within_100_km, label=mean_population_within_100_km), nudge_y=175000, size=3)
```

__Eruption Dates__

This is a histogram showing the number of volcanos that have a known eruption within a certian number of years in the past. Currently, the bin width is set at 1,000 years. However, this doesn't discriminate well for the most recent years. Something needs to be done to split up the more recent and the older data.

```{r}
ggplot(volcano, aes(x=last_eruption_year))+
  geom_histogram(binwidth=1000)+
  ggtitle("Histogram of Last Known Eruptions")+
  labs(x="Date", y="Observations")+
  theme(panel.grid=element_blank())
```

__Multiple Comparisons - Last Known Eruption__

This analysis seeks to determine whether or not certain types of volcanoes are more likely to erupt than others based on their last known eruption date. In this boxplot, the further down the y-axis, the longer it has been since an eruption.
```{r}
ggplot(volcano, aes(x=last_eruption_year, y=primary_volcano_type))+
  geom_boxplot()+
  ggtitle("Boxplot of Last Eruption Year by Volcano Type")+
  labs(x="Year", y="Volcano Type")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: Mean last eruption year is equal among all volcano types
#HA: At least one mean eruption year is not equal
model6=lm(last_eruption_year~primary_volcano_type, data=volcano)
res_values6<-residuals(model6)
shapiro.test(res_values6)
leveneTest(model6)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW6<-kruskal.test(last_eruption_year~primary_volcano_type, data=volcano)
KW6
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN6<-as.data.frame(dunn.test(volcano$last_eruption_year, g=volcano$primary_volcano_type, kw=T))
```

Much like above, this analysis seeks to determine if volcanos in different tectonic settings, rather than just different volcano types, are more likely than others to erupt more frequently. Here again, the rationale is that the further down the y-axis, the longer it has been since an eruption.
```{r}
ggplot(volcano, aes(x=last_eruption_year, y=tectonic_settings))+
  geom_boxplot()+
  ggtitle("Boxplot of Last Eruption Year by Tectonic Setting")+
  labs(x="Year", y="Tectonic Setting")+
  coord_flip()+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  stat_summary(fun=mean, geom="point", pch="+", size=2.5, color="red", fill="red")

#Ho: Mean last eruption year is equal among all tectonic settings.
#HA: At least one mean eruption year is not equal.
model7=lm(last_eruption_year~tectonic_settings, data=volcano)
res_values7<-residuals(model7)
shapiro.test(res_values7)
leveneTest(model7)
#Normality of residuals and homogeneity of variance not met; therefore, an ANOVA cannot be perfomred. The non-parametric Kruskal-Wallis test is performed instead.
KW7<-kruskal.test(last_eruption_year~tectonic_settings, data=volcano)
KW7
#Dunn's post hoc test is performed to differentiate which values significantly differ from one another.
DUNN7<-as.data.frame(dunn.test(volcano$last_eruption_year, g=volcano$tectonic_settings, kw=T))
```

__Linear Regression and Correlation of Volcano Elevation with Last Known Eruption Year__

Here, a reasonable assumption that could be made about volcanos is that ones that erupt more frequently are taller because they are adding more layers of molten rock to their outer surface. To test this assumption, I performed linear regression analysis between last known eruption year and elevation. Based on the results, we can conclude that there is no significant linear relationship between elevation and last known eruption date.
```{r}
#Ho: Slope = 0 (no linear relationship)
#HA: Slope not equal to 0 (linear relationship)

library(ggpubr)

ggplot(volcano, aes(x=last_eruption_year, y=elevation))+
  geom_point(alpha=1/5)+
  ggtitle("Last Eruption Year vs Elevation")+
  labs(x="Year", y="Elevation")+
  theme(panel.grid=element_blank())+
  stat_cor()

```


___Global Volcano Locations___

Here I create a bar chart showing the number of volcanos present in various regions of the world. Since actual latitude and longitude coordinates were provided in this data file, following this regional grouping bar chart, I use the `threejs` package to plot each of the coordinates on a global map. Height of individual bars on the map represent volcano elevation, while heatmap colors indicate the number of years since the last known eruption (red = most recent, white = most distant past).
```{r}
region_count<-volcano %>% 
  group_by(region) %>%
  summarise(no_rows2 = length(region))

ggplot(volcano, aes(x=region))+
  geom_bar()+
  ggtitle("Number of Volcanos by Region")+
  labs(x="Region", y="Number of Volcanos")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=region_count ,aes(x=region, y=no_rows2, label=no_rows2), nudge_y=10)

library(threejs)

for_globe<-volcano[,c("latitude", "longitude", "years_ago", "elevation")]
colors=as.numeric(cut(for_globe$years_ago,
                      breaks=1000, include.lowest=T, na.rm=T))
colors=heat.colors(colors)
globejs(lat=for_globe$latitude, long=for_globe$longitude, val=(0.025*for_globe$elevation), color=colors, atmosphere=T, pointsize=0.75, emissive=T)

#Might do something with the latitude groupings (Antarctic Circle, Tropic of Capricorn, Equator, Tropic of Cancer, Arctic Circle)
s<-volcano%>%filter(latitude >=-90 & latitude <=-66.5)
s2<-volcano%>%filter(latitude >=-66.5 & latitude <=-23.5)
s3<-volcano%>%filter(latitude >=-23.5 & latitude <=0)
s4<-volcano%>%filter(latitude >=0 & latitude <=23.5)
s5<-volcano%>%filter(latitude >=23.5 & latitude <=66.5)
s6<-volcano%>%filter(latitude >=66.5 & latitude <=90)

```

__Areas that Need More Work before Project Submission__

Here is a bar chart showing how many volcanos have different types of known evidence of past eruptions. 
```{r}
evidence_count<-volcano %>% 
  group_by(evidence_category) %>%
  summarise(no_rows4 = length(evidence_category))

ggplot(volcano, aes(x=evidence_category))+
  geom_bar()+
  ggtitle("Number of Volcanos by Evidence Category")+
  labs(x="Evidence Category", y="Number of Volcanos")+
  theme(panel.grid=element_blank(), axis.text.x = element_text(angle = 45, hjust = 1, vjust = 0.95))+
  geom_text(data=evidence_count ,aes(x=evidence_category, y=no_rows4, label=no_rows4), nudge_y=30)


ggplot(eruptions, aes(x=longitude, y=vei))+
  geom_count(na.rm = T)+
  ggtitle("Volcano eruption index distributed over longitude")+
  labs(x="Longitude", y="vei")
```
